<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
	<link rel="stylesheet" href="sign-up.css">
</head>
<body>
    <div class="signin-label">sign in</div>

    <div class="container">
        <div class="signup-card">
            <div class="signup-title">sign up</div>

            <form id="signupForm">
                <div class="form-group">
                    <label>
                        <span class="icon">üë§</span>
                        <input type="text" id="name" placeholder="Name" required>
                    </label>
                </div>

                <div class="form-group">
                    <label>
                        <span class="icon">‚úâ</span>
                        <input type="email"  id="email" placeholder="e-mail address" required>
                    </label>
                </div>

                <div class="form-group">
                    <label>
                        <span class="icon">üîí</span>
                        <input type="password" id="password" placeholder="Password" required>
                        <span class="eye-icon" onclick="togglePassword()">üëÅÔ∏è</span>
                    </label>
                </div>

                <button type="submit" class="signin-btn">Sign in</button>
            </form>

            <div class="divider-text">sign up with</div>

            <div class="social-buttons">
                <button class="social-btn" onclick="handleAppleSignup()">
                    <span class="social-icon">Ô£ø</span>
                    Apple
                </button>
                <button class="social-btn" onclick="handleGoogleSignup()">
                    <span class="social-icon">üîç</span>
                    Google
                </button>
            </div>

            <div class="login-link">
                Already have an account? <a href="login.html">login</a>
            </div>
        </div>
    </div>

    <script>
        function togglePassword() {
            const password = document.getElementById('password');
            if (!password) return;
            password.type = password.type === 'password' ? 'text' : 'password';
        }

        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            const payload = { name, email, password };

            // Pick correct API base: if running from file:// or any non-localhost origin, fall back to localhost:3000
            const isFile = window.location.protocol === 'file:';
            const isLocalhost = /localhost|127\.0\.0\.1/.test(window.location.hostname);
            const base = isFile ? 'http://localhost:3000' : (isLocalhost ? window.location.origin : 'http://localhost:3000');

            try {
                const res = await fetch(`${base}/api/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await res.json().catch(() => null);

                if (!res.ok) {
                    alert('Error: ' + (data && data.message ? data.message : res.statusText));
                    return;
                }

                alert(data && data.message ? data.message : 'Signed up successfully');
                window.location.href = 'profile_setup.html';
            } catch (err) {
                console.error(err);
                alert('Network error. See console.');
            }
        });

        function handleAppleSignup() {
            alert('apple Sign Up');
        }

        function handleGoogleSignup() {
            alert('google Sign Up');
        }

    </script>
</body>
</html>